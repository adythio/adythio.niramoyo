<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bright Sticky Notes ‚Äî Single File</title>
  <style>
    :root{
      --bg:#0f1724; --card-bg:#fff; --accent:#ffcc00;
      --note-width:240px; --note-height:200px;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:linear-gradient(180deg,#071027 0%, #0b1f3c 100%);color:#0b1220;overflow:hidden}

    /* Top bar */
    .topbar{position:fixed;left:12px;right:12px;top:12px;height:64px;display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));backdrop-filter:blur(6px);z-index:9999}
    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,#ff6b6b,#ffcc66);display:flex;align-items:center;justify-content:center;font-weight:700;color:white}
    .controls{display:flex;gap:8px;align-items:center;margin-left:6px}
    button, .icon-btn{background:transparent;border:0;padding:8px 12px;border-radius:8px;color:white;cursor:pointer}
    input[type=search]{padding:8px 12px;border-radius:10px;border:0;min-width:220px}
    .small{font-size:13px;opacity:0.9}

    /* Palette */
    .palette{display:flex;gap:6px;align-items:center}
    .color-swatch{width:28px;height:24px;border-radius:6px;cursor:pointer;box-shadow:0 2px 6px rgba(2,6,23,0.4)}

    /* Canvas */
    .canvas{position:absolute;left:0;right:0;top:88px;bottom:0;overflow:auto}

    /* Note */
    .note{position:absolute;width:var(--note-width);height:var(--note-height);background:var(--card-bg);border-radius:10px;box-shadow:0 8px 24px rgba(2,6,23,0.6);display:flex;flex-direction:column;overflow:hidden;resize:both}
    .note .header{display:flex;align-items:center;justify-content:space-between;padding:8px;cursor:grab;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-bottom:1px solid rgba(0,0,0,0.06)}
    .note .title{font-weight:700;font-size:14px;min-width:90px}
    .note .toolbar{display:flex;gap:6px;align-items:center}
    .note .content{flex:1;padding:10px;overflow:auto}
    .note .content [contenteditable]{outline:none;min-height:40px}
    .note .meta{display:flex;gap:6px;align-items:center;padding:6px;border-top:1px solid rgba(0,0,0,0.04);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0))}

    .chip{padding:6px 8px;border-radius:999px;font-size:12px;background:rgba(255,255,255,0.06);cursor:pointer}
    .ghost{opacity:0.6}

    /* Floating helper */
    .hint{position:fixed;right:14px;bottom:14px;background:linear-gradient(180deg,#fff,#f2f2f2);padding:10px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6);max-width:340px}

    /* Colors */
    .c-yellow{background:#ffeb99} .c-pink{background:#ffd6e6} .c-blue{background:#d9edff}
    .c-green{background:#d9ffd6} .c-orange{background:#ffe3cc} .c-purple{background:#ead6ff}

    /* Small utility buttons */
    .btn{background:transparent;border:0;padding:6px;border-radius:8px;cursor:pointer}
    .btn-danger{color:#b00020}

    /* collapsed stack header */
    .stack{position:fixed;left:24px;bottom:110px;background:linear-gradient(90deg,#ffffff11,#ffffff06);padding:8px;border-radius:8px;backdrop-filter:blur(6px)}

    /* responsive */
    @media (max-width:700px){.topbar{left:8px;right:8px}.brand .text{display:none}}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <div class="logo">SN</div>
      <div class="text">
        <div style="font-weight:700;color:white">Bright Sticky Notes</div>
        <div class="small" style="color:#a6b4c8">Local-first ¬∑ drag, resize, color, tag, reminders</div>
      </div>
    </div>

    <div class="controls" style="margin-left:8px">
      <button id="newNoteBtn">+ New Note</button>
      <div class="palette" title="Quick color" aria-hidden>
        <div class="color-swatch c-yellow" data-color="#ffeb99"></div>
        <div class="color-swatch c-pink" data-color="#ffd6e6"></div>
        <div class="color-swatch c-blue" data-color="#d9edff"></div>
        <div class="color-swatch c-green" data-color="#d9ffd6"></div>
        <div class="color-swatch c-orange" data-color="#ffe3cc"></div>
        <div class="color-swatch c-purple" data-color="#ead6ff"></div>
      </div>
    </div>

    <input type="search" id="search" placeholder="Search notes, tags, content..." />

    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <input id="tagFilter" placeholder="Filter tag (comma separated)" style="padding:8px;border-radius:10px;border:0;min-width:160px" />
      <button id="exportBtn">Export JSON</button>
      <button id="importBtn">Import</button>
      <input type="file" id="importFile" accept="application/json" style="display:none" />
    </div>
  </div>

  <div class="canvas" id="canvas"></div>

  <div class="hint" id="hint">
    <strong>Tips</strong>
    <ul style="margin:6px 0 0 16px;padding:0">
      <li>Create notes, drag their header to move, drag corner to resize.</li>
      <li>Double-click title or content to edit. Use <code>#tag</code> inline or the tag input.</li>
      <li>Set reminders with the clock icon ‚Äî the browser will notify you (allow notifications).</li>
    </ul>
  </div>

  <div class="stack" id="stackBox">Stacks: <span id="stackCount">0</span></div>

  <template id="noteTpl">
    <div class="note" data-id="">
      <div class="header">
        <div style="display:flex;gap:8px;align-items:center">
          <div class="title" contenteditable="true">New note</div>
          <div class="chip" title="tag">#tag</div>
        </div>
        <div class="toolbar">
          <button class="btn" data-action="pin" title="Pin to top">üìå</button>
          <button class="btn" data-action="checklist" title="Toggle checklist">‚òëÔ∏è</button>
          <button class="btn" data-action="remind" title="Set reminder">‚è∞</button>
          <button class="btn" data-action="attach" title="Attach image">üñºÔ∏è</button>
          <button class="btn" data-action="duplicate" title="Duplicate">‚éò</button>
          <button class="btn btn-danger" data-action="delete" title="Delete">‚úñ</button>
        </div>
      </div>
      <div class="content">
        <div class="editable" contenteditable="true">Write something...</div>
        <div class="attachments" style="margin-top:8px;display:flex;flex-wrap:wrap;gap:6px"></div>
      </div>
      <div class="meta">
        <input class="tagInput" placeholder="tags, comma separated" style="flex:1;padding:6px;border-radius:6px;border:0" />
        <div class="small ghost remindLabel">No reminder</div>
      </div>
    </div>
  </template>

  <script>
    /* STORAGE KEY */
    const STORE_KEY = 'stickyNotes_v1';

    /* utility */
    const uid = () => 'n_' + Math.random().toString(36).slice(2,9);
    const q = sel => document.querySelector(sel);
    const qq = sel => Array.from(document.querySelectorAll(sel));

    /* app state */
    let notes = {}; // id -> note data
    let zIndex = 10;
    const canvas = q('#canvas');

    /* load */
    function saveAll(){
      localStorage.setItem(STORE_KEY, JSON.stringify({notes, zIndex}));
    }
    function loadAll(){
      try{
        const raw = localStorage.getItem(STORE_KEY);
        if(!raw) return;
        const data = JSON.parse(raw);
        notes = data.notes || {};
        zIndex = data.zIndex || 10;
        Object.values(notes).forEach(n=>renderNote(n));
        updateStackCount();
      }catch(e){console.error('load',e)}
    }

    /* create note object and DOM */
    function createNote(opts = {}){
      const id = opts.id || uid();
      const n = Object.assign({
        id, title: opts.title||'New note', content: opts.content||'', color: opts.color||'#ffeb99', x: opts.x||20, y: opts.y||20, w: opts.w||240, h: opts.h||200, tags: opts.tags||[], pinned: !!opts.pinned, reminder: opts.reminder||null, attachments: opts.attachments||[], checklist: !!opts.checklist
      }, opts);
      notes[id] = n;
      renderNote(n);
      saveAll();
      return n;
    }

    function renderNote(data){
      // if node exists update, else create
      let el = canvas.querySelector('.note[data-id="'+data.id+'"]');
      if(!el){
        const tpl = q('#noteTpl');
        el = tpl.content.firstElementChild.cloneNode(true);
        el.dataset.id = data.id;
        canvas.appendChild(el);
        bindNoteEvents(el);
      }
      // apply data
      el.style.left = data.x + 'px'; el.style.top = data.y + 'px';
      el.style.width = data.w + 'px'; el.style.height = data.h + 'px';
      el.style.background = data.color;
      el.style.zIndex = data.pinned ? 9999 : (data.z || ++zIndex);
      el.querySelector('.title').textContent = data.title;
      const content = el.querySelector('.editable');
      content.innerHTML = data.content || '';
      el.querySelector('.tagInput').value = (data.tags || []).join(', ');
      el.querySelector('.chip').textContent = (data.tags && data.tags[0]) ? ('#'+data.tags[0]) : '#tag';
      el.querySelector('.remindLabel').textContent = data.reminder ? ('Remind: ' + new Date(data.reminder).toLocaleString()) : 'No reminder';
      // attachments
      const att = el.querySelector('.attachments'); att.innerHTML = '';
      (data.attachments||[]).forEach(src=>{const i = document.createElement('img'); i.src = src; i.style.width='64px'; i.style.height='64px'; i.style.objectFit='cover'; i.style.borderRadius='6px'; att.appendChild(i)});

      // checklist rendering
      renderChecklist(el, data);
    }

    /* render checklist: convert lines like - [ ] or - [x] to checkboxes if checklist mode on */
    function renderChecklist(el, data){
      const content = el.querySelector('.editable');
      if(data.checklist){
        // try parse lines into <label><input type=checkbox> text
        const lines = (data.content||'').split(/[\r\n]+/).filter(Boolean);
        content.innerHTML = lines.map((ln,i)=>{
          const m = ln.match(/^\s*[-*]\s*\[(x|X| )\]\s*(.*)$/);
          if(m){
            const checked = /x/i.test(m[1]);
            return `<label data-line="${i}" style="display:block"><input type="checkbox" ${checked? 'checked':''}/> <span>${escapeHTML(m[2])}</span></label>`
          }
          return `<div data-line="${i}">${escapeHTML(ln)}</div>`
        }).join('');
      }
    }

    function escapeHTML(s){return (s+'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c])}

    /* bind note events for drag, resize, editing, buttons */
    function bindNoteEvents(el){
      const id = el.dataset.id;
      const header = el.querySelector('.header');
      const title = el.querySelector('.title');
      const editable = el.querySelector('.editable');
      const tagInput = el.querySelector('.tagInput');

      // bring to front on mousedown
      el.addEventListener('mousedown', ()=>{ setZ(el); });

      // drag
      header.addEventListener('mousedown', startDrag);
      function startDrag(e){
        if(e.button!==0) return;
        e.preventDefault();
        const rect = el.getBoundingClientRect();
        const offsetX = e.clientX - rect.left;
        const offsetY = e.clientY - rect.top;
        function onMove(ev){ el.style.left = (ev.clientX - offsetX) + 'px'; el.style.top = (ev.clientY - offsetY) + 'px'; }
        function up(){ document.removeEventListener('mousemove', onMove); document.removeEventListener('mouseup', up); savePosition(); }
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', up);
      }

      // track inline edits
      title.addEventListener('input', ()=>{ notes[id].title = title.textContent; saveAll(); });
      editable.addEventListener('input', ()=>{ notes[id].content = editable.innerHTML; saveAll(); });

      // save size/position when mouseup outside
      el.addEventListener('mouseup', ()=>{ savePosition(); saveSize(); });
      el.addEventListener('mouseleave', ()=>{ savePosition(); saveSize(); });

      // resize observer
      const ro = new ResizeObserver(()=>{ notes[id].w = el.offsetWidth; notes[id].h = el.offsetHeight; saveAll(); });
      ro.observe(el);

      // tag input
      tagInput.addEventListener('change', ()=>{ notes[id].tags = tagInput.value.split(',').map(s=>s.trim()).filter(Boolean); el.querySelector('.chip').textContent = notes[id].tags[0] ? ('#'+notes[id].tags[0]) : '#tag'; saveAll(); updateStackCount(); });

      // toolbar actions
      el.querySelectorAll('[data-action]').forEach(b=>b.addEventListener('click', e=>{
        const a = b.dataset.action; handleAction(a, id, el);
      }));

      // double-click title/content to focus edit
      title.addEventListener('dblclick', ()=>{ title.focus(); document.execCommand('selectAll',false,null)});
      editable.addEventListener('dblclick', ()=>{ editable.focus(); });

      // attach drag+drop images to note
      el.addEventListener('dragover', e=>{ e.preventDefault(); el.style.opacity=0.9 });
      el.addEventListener('dragleave', e=>{ el.style.opacity=1 });
      el.addEventListener('drop', e=>{
        e.preventDefault(); el.style.opacity=1; const f = e.dataTransfer.files && e.dataTransfer.files[0];
        if(f && f.type.startsWith('image/')){
          const reader = new FileReader(); reader.onload = ev=>{ notes[id].attachments.push(ev.target.result); saveAll(); renderNote(notes[id]); }
          reader.readAsDataURL(f);
        }
      });
    }

    function savePosition(){ const els = canvas.querySelectorAll('.note'); els.forEach(el=>{ const id = el.dataset.id; notes[id].x = el.offsetLeft; notes[id].y = el.offsetTop; }); saveAll(); }
    function saveSize(){ const els = canvas.querySelectorAll('.note'); els.forEach(el=>{ const id = el.dataset.id; notes[id].w = el.offsetWidth; notes[id].h = el.offsetHeight; }); saveAll(); }

    function setZ(el){ el.style.zIndex = ++zIndex; const id = el.dataset.id; notes[id].z = zIndex; saveAll(); }

    function handleAction(action, id, el){
      if(action==='delete'){ if(confirm('Delete note?')){ delete notes[id]; el.remove(); saveAll(); updateStackCount(); }}
      else if(action==='duplicate'){ const n = Object.assign({}, notes[id]); n.id = uid(); n.x = notes[id].x + 20; n.y = notes[id].y + 20; createNote(n); }
      else if(action==='pin'){ notes[id].pinned = !notes[id].pinned; renderNote(notes[id]); saveAll(); }
      else if(action==='checklist'){ notes[id].checklist = !notes[id].checklist; saveAll(); renderNote(notes[id]); }
      else if(action==='attach'){ const inp = document.createElement('input'); inp.type='file'; inp.accept='image/*'; inp.onchange = e=>{ const f = e.target.files[0]; if(f){ const r=new FileReader(); r.onload=ev=>{ notes[id].attachments.push(ev.target.result); saveAll(); renderNote(notes[id]); } ; r.readAsDataURL(f); } }; inp.click(); }
      else if(action==='remind'){ const when = prompt('Set reminder (YYYY-MM-DD HH:mm) or empty to clear', notes[id].reminder ? new Date(notes[id].reminder).toISOString().slice(0,16).replace('T',' ') : ''); if(when){ const parsed = Date.parse(when.replace(' ','T')); if(!isNaN(parsed)){ notes[id].reminder = parsed; saveAll(); renderNote(notes[id]); scheduleReminder(notes[id]); alert('Reminder set for ' + new Date(parsed).toLocaleString()) } else alert('Invalid date format') } else { notes[id].reminder = null; saveAll(); renderNote(notes[id]); }}
    }

    // reminders
    const reminderTimers = {};
    function scheduleReminder(note){ if(!note.reminder) return; const now = Date.now(); const ms = note.reminder - now; if(ms <= 0){ triggerReminder(note); return; } if(reminderTimers[note.id]) clearTimeout(reminderTimers[note.id]); reminderTimers[note.id] = setTimeout(()=>triggerReminder(note), Math.min(ms, 2147483647)); }
    function triggerReminder(note){
      // browser notification
      if(window.Notification && Notification.permission === 'granted'){
        new Notification('Reminder: ' + (note.title||'Note'), {body: stripHtml(note.content).slice(0,120) || 'You set a reminder'});
      }else{
        alert('Reminder: ' + (note.title||'Note') + '\n\n' + stripHtml(note.content).slice(0,200));
      }
      note.reminder = null; saveAll(); renderNote(note);
    }
    function stripHtml(s){ return (s||'').replace(/<[^>]+>/g,'').replace(/\s+/g,' ').trim(); }

    // when app starts, schedule all reminders
    function scheduleAll(){ Object.values(notes).forEach(n=>{ if(n.reminder) scheduleReminder(n); }); }

    /* search & filter */
    q('#search').addEventListener('input', ()=>{ applyFilters(); });
    q('#tagFilter').addEventListener('input', ()=>{ applyFilters(); });

    function applyFilters(){ const qstr = q('#search').value.toLowerCase(); const tagf = q('#tagFilter').value.toLowerCase().split(',').map(s=>s.trim()).filter(Boolean);
      Object.values(notes).forEach(n=>{
        const el = canvas.querySelector('.note[data-id="'+n.id+'"]'); if(!el) return;
        const hay = ((n.title||'') + ' ' + stripHtml(n.content) + ' ' + (n.tags||[]).join(' ')).toLowerCase();
        const okQ = !qstr || hay.includes(qstr);
        const okTag = !tagf.length || tagf.every(t=> (n.tags||[]).map(s=>s.toLowerCase()).includes(t));
        el.style.display = (okQ && okTag) ? 'flex' : 'none';
      });
    }

    /* export/import */
    q('#exportBtn').addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify({notes,zIndex},null,2)],{type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download='sticky-notes-export.json'; a.click(); });
    q('#importBtn').addEventListener('click', ()=> q('#importFile').click());
    q('#importFile').addEventListener('change', e=>{ const f = e.target.files[0]; if(!f) return; const r = new FileReader(); r.onload=ev=>{ try{ const data = JSON.parse(ev.target.result); notes = data.notes || {}; zIndex = data.zIndex || 10; canvas.innerHTML=''; Object.values(notes).forEach(n=>renderNote(n)); saveAll(); scheduleAll(); updateStackCount(); alert('Imported') }catch(err){alert('Import failed: '+err)} }; r.readAsText(f); });

    /* new note btn */
    q('#newNoteBtn').addEventListener('click', ()=>createNote({x:40 + Object.keys(notes).length*16 % 300, y:40 + Object.keys(notes).length*10 % 200}));

    // palette quick color
    qq('.color-swatch').forEach(s=>s.addEventListener('click', ()=>{ const color = s.dataset.color; createNote({color}); }));

    // initial load
    loadAll(); scheduleAll();

    // schedule reminders check every 30s as fallback
    setInterval(()=>{ Object.values(notes).forEach(n=>{ if(n.reminder) scheduleReminder(n); }); }, 30000);

    // request notification permission on first interaction
    document.addEventListener('click', function requestNotif(){ if(window.Notification && Notification.permission === 'default'){ Notification.requestPermission(); } document.removeEventListener('click', requestNotif); });

    // update stack count: group by first tag
    function updateStackCount(){ const groups = {}; Object.values(notes).forEach(n=>{ const k = (n.tags && n.tags[0]) ? n.tags[0] : '_untagged'; groups[k] = groups[k]||[]; groups[k].push(n); }); q('#stackCount').textContent = Object.keys(groups).length; }

    // duplicate on ctrl+d
    document.addEventListener('keydown', e=>{ if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='d'){ e.preventDefault(); const sel = document.activeElement.closest && document.activeElement.closest('.note'); if(sel){ handleAction('duplicate', sel.dataset.id, sel); } } });

    // helper: if no notes create sample
    if(!Object.keys(notes).length){ createNote({title:'Welcome!', content:'This is a colorful sticky note. Double-click the text to edit. Use the toolbar for checklist, reminders, attachments, and pinning.', color:'#ffd6e6'});
      createNote({title:'Checklist', content:'- [ ] Buy milk\n- [ ] Call Alice\n- [x] Setup app', color:'#d9edff', checklist:true, x:320});
      saveAll(); }

  </script>
</body>
</html>
